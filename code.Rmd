---
title: "code"
output: html_notebook
---

Scenario:

Describe your data in terms of observation, data type and summary statistics.

load data:

```{r}
library(readr)
library(tidyverse)
library(ggplot2)
library(tidytext)
```

```{r}
data <- read.csv("/Users/reginachua/Documents/R/dataAnalysisProject-/spotify_songs.csv")
View(data)
head(data)
```

-   data size

```{r}
dim(data)
nrow(data)
```

-   what are the variables(columns name??)

```{r}
summary(data)
```

-   max and min year , range...

-   most common genre

```{r}
length(unique(data$playlist_genre))

genre <- data %>% group_by(playlist_genre) %>% summarise(n = n())%>%arrange(desc(n))
                                                                            
genre 

subgenre <-  data %>% group_by(playlist_subgenre) %>% summarise(n = n())%>%arrange(desc(n))

subgenre
                                                                            

#ggplot(genre, aes(playlist_genre, n)) +                                    
#  geom_bar(stat = "identity")

ggplot(genre,aes(x = reorder(playlist_genre, n), y = n)) +                                    
  geom_bar(stat = "identity")


ggplot(subgenre,aes(x = reorder(playlist_subgenre, n), y = n)) +                                     geom_bar(stat = "identity")

```

-   most popular genre

```{r}
popular_genre <- data %>% group_by(playlist_genre) %>% summarise(n = mean(track_popularity))%>%arrange(desc(n))

popular_genre

ggplot(popular_genre,aes(x = reorder(playlist_genre, n), y = n)) +                            
  geom_bar(stat = "identity")

popular_subgenre <- data %>% group_by(playlist_subgenre) %>% summarise(n = mean(track_popularity))%>%arrange(desc(n))

popular_subgenre

ggplot(popular_subgenre,aes(x = reorder(playlist_subgenre, n), y = n)) +                             geom_bar(stat = "identity")
                                                                            
```

-   top 10 artist

```{r}
top_artists=data%>%group_by(track_artist)%>%summarise(n=n())%>%arrange(desc(n))%>%top_n(10)
top_artists
```

-   language bar graph

```{r}
ggplot(data = data) + 
  geom_bar(mapping = aes(x = language))
```

-   top 10 popular tracks

```{r}
top_tracks=data%>%arrange(desc(track_popularity))%>%top_n(10)
top_tracks
```

-   top 10 most danceable songs

```{r}
top_danceable_songs=data%>%arrange(desc(danceability))%>%top_n(10)
top_danceable_songs
```

-   top 10 most energetic songs

```{r}
top_energetic_songs=data%>%arrange(desc(energy))%>%top_n(10)
top_energetic_songs
```

-   show relationships(ggplot) any feature and popularity

```{r}
ggplot(data = data) + 
  geom_smooth(mapping = aes(x = energy, y = danceability))+
  geom_point(mapping = aes(x = energy, y = danceability))
```

```{r}
ggplot(data = data) + 
  geom_smooth(mapping = aes(x = danceability, y = track_popularity))+
  geom_point(mapping = aes(x = danceability, y = track_popularity))
```

nrc package R for sentimental analysis:

Hypothesis:

Songs with positive sentiments are more popular.

Test:

```{r}
sentiments <- get_sentiments("afinn")
#get_sentiments("nrc")
```

```{r}
library(janeaustenr)
library(dplyr)
library(stringr)

tidy_data <- data %>%
  filter(language == "en") %>%
  group_by(track_id) %>%
  ungroup() %>%
  unnest_tokens(word, lyrics)

tidy_data
tokens_sentiment = inner_join(tidy_data,sentiments,by="word")

tokens_sentiment

avg_sentiments <- tokens_sentiment %>% group_by(track_id) %>% summarise(n = mean(value))%>%arrange(desc(n))

avg_sentiments

avg_sentiment <-  inner_join(avg_sentiments,data,by="track_id")

avg_sentiment


```

```{r}

avg_sentiment %>% group_by(n) %>% summarise(sum = n())
avg_sentiment


ggplot(data = avg_sentiment ) + 
  geom_smooth(mapping = aes(x = track_popularity, y = n))+
  geom_point(mapping = aes(x = track_popularity, y = n, size = n))



```
